// ===========================
// TRANSLATIONS
// ===========================
const translations = {
    en: {
        nav_home: 'Home',
        nav_features: 'Features',
        nav_tailors: 'Tailors',
        nav_about: 'About',
        nav_contact: 'Contact',
        btn_login: 'Login',
        btn_signup: 'Sign Up',
        menu_dashboard: 'Dashboard',
        menu_profile: 'Profile',
        menu_settings: 'Settings',
        menu_logout: 'Logout',
        hero_title: 'Custom Tailoring,<br>Made Simple',
        hero_subtitle: 'Connect with skilled home-grown tailors and designers for bespoke clothing that fits your style perfectly',
        btn_join_customer: 'Join as Customer',
        btn_join_tailor: 'Join as Tailor',
        stat_customers: 'Happy Customers',
        stat_tailors: 'Expert Tailors',
        stat_orders: 'Orders Completed',
        features_title: 'Why Choose TailorConnect?',
        features_subtitle: 'Everything you need for perfect custom clothing',
        feature1_title: 'Expert Tailors',
        feature1_desc: 'Connect with verified, skilled tailors with years of experience in custom clothing',
        feature2_title: 'Secure Payments',
        feature2_desc: 'Safe and encrypted payment processing with multiple payment options',
        feature3_title: 'Real-Time Tracking',
        feature3_desc: 'Track your order status from design to delivery with live updates',
        feature4_title: 'Custom Measurements',
        feature4_desc: 'Upload your measurements for a perfect fit every time',
        feature5_title: 'Direct Chat',
        feature5_desc: 'Communicate directly with tailors to discuss your requirements',
        feature6_title: 'Quality Guarantee',
        feature6_desc: '100% satisfaction guarantee with hassle-free alterations',
        tailors_title: 'Featured Tailors',
        tailors_subtitle: 'Meet our top-rated expert tailors',
        testimonials_title: 'What Our Customers Say',
        testimonials_subtitle: 'Real experiences from real people',
        about_title: 'About TailorConnect',
        about_p1: 'TailorConnect was born from a simple idea: everyone deserves perfectly fitted, custom-made clothing without the hassle of finding skilled tailors.',
        about_p2: 'We bridge the gap between talented home-grown tailors and customers seeking quality craftsmanship. Our platform empowers local artisans while providing customers with convenient access to expert tailoring services.',
        about_p3: 'With over 500 verified tailors and 50,000+ satisfied customers, we\'re revolutionizing the custom clothing industry one stitch at a time.',
        contact_title: 'Get In Touch',
        contact_subtitle: 'We\'d love to hear from you',
        form_name: 'Name',
        form_email: 'Email',
        form_phone: 'Phone',
        form_message: 'Message',
        btn_send: 'Send Message',
        contact_email: 'Email',
        contact_phone_title: 'Phone',
        contact_address: 'Address',
        footer_desc: 'Connecting customers with skilled tailors for perfect custom clothing.',
        footer_company: 'Company',
        footer_about: 'About Us',
        footer_contact: 'Contact',
        footer_careers: 'Careers',
        footer_blog: 'Blog',
        footer_support: 'Support',
        footer_help: 'Help Center',
        footer_faq: 'FAQ',
        footer_terms: 'Terms of Service',
        footer_privacy: 'Privacy Policy',
        footer_newsletter: 'Newsletter',
        footer_newsletter_desc: 'Subscribe to get updates and offers',
        btn_subscribe: 'Subscribe'
    },
    hi: {
        nav_home: '‡§π‡•ã‡§Æ',
        nav_features: '‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Å',
        nav_tailors: '‡§¶‡§∞‡•ç‡§ú‡•Ä',
        nav_about: '‡§π‡§Æ‡§æ‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç',
        nav_contact: '‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç',
        btn_login: '‡§≤‡•â‡§ó‡§ø‡§®',
        btn_signup: '‡§∏‡§æ‡§á‡§® ‡§Ö‡§™',
        menu_dashboard: '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
        menu_profile: '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤',
        menu_settings: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
        menu_logout: '‡§≤‡•â‡§ó‡§Ü‡§â‡§ü',
        hero_title: '‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§ü‡•á‡§≤‡§∞‡§ø‡§Ç‡§ó,<br>‡§∏‡§∞‡§≤ ‡§¨‡§®‡§æ‡§Ø‡§æ',
        hero_subtitle: '‡§ï‡•Å‡§∂‡§≤ ‡§¶‡§∞‡•ç‡§ú‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§°‡§ø‡§ú‡§æ‡§á‡§®‡§∞‡•ã‡§Ç ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á‡§Ç ‡§ú‡•ã ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡•ç‡§ü‡§æ‡§á‡§≤ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∞‡•Ç‡§™ ‡§¨‡•á‡§∏‡•ç‡§™‡•ã‡§ï ‡§ï‡§™‡§°‡§º‡•á ‡§¨‡§®‡§æ‡§§‡•á ‡§π‡•à‡§Ç',
        btn_join_customer: '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç',
        btn_join_tailor: '‡§¶‡§∞‡•ç‡§ú‡•Ä ‡§ï‡•á ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•ã‡§Ç',
        stat_customers: '‡§ñ‡•Å‡§∂ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï',
        stat_tailors: '‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§¶‡§∞‡•ç‡§ú‡•Ä',
        stat_orders: '‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ë‡§∞‡•ç‡§°‡§∞',
        features_title: 'TailorConnect ‡§ï‡•ç‡§Ø‡•ã‡§Ç ‡§ö‡•Å‡§®‡•á‡§Ç?',
        features_subtitle: '‡§™‡§∞‡§´‡•á‡§ï‡•ç‡§ü ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§¨ ‡§ï‡•Å‡§õ',
        feature1_title: '‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§¶‡§∞‡•ç‡§ú‡•Ä',
        feature1_desc: '‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§µ‡§∞‡•ç‡§∑‡•ã‡§Ç ‡§ï‡•á ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§µ‡§æ‡§≤‡•á ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§, ‡§ï‡•Å‡§∂‡§≤ ‡§¶‡§∞‡•ç‡§ú‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡•á‡§Ç',
        feature2_title: '‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§≠‡•Å‡§ó‡§§‡§æ‡§®',
        feature2_desc: '‡§ï‡§à ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§î‡§∞ ‡§è‡§®‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü‡•á‡§° ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó',
        feature3_title: '‡§∞‡•Ä‡§Ø‡§≤-‡§ü‡§æ‡§á‡§Æ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó',
        feature3_desc: '‡§≤‡§æ‡§á‡§µ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•á ‡§∏‡§æ‡§• ‡§°‡§ø‡§ú‡§æ‡§á‡§® ‡§∏‡•á ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§§‡§ï ‡§Ö‡§™‡§®‡•á ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ü‡•ç‡§∞‡•à‡§ï ‡§ï‡§∞‡•á‡§Ç',
        feature4_title: '‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§Æ‡§æ‡§™',
        feature4_desc: '‡§π‡§∞ ‡§¨‡§æ‡§∞ ‡§∏‡§π‡•Ä ‡§´‡§ø‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•Ä ‡§Æ‡§æ‡§™ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç',
        feature5_title: '‡§°‡§æ‡§Ø‡§∞‡•á‡§ï‡•ç‡§ü ‡§ö‡•à‡§ü',
        feature5_desc: '‡§Ö‡§™‡§®‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§ì‡§Ç ‡§™‡§∞ ‡§ö‡§∞‡•ç‡§ö‡§æ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡§∞‡•ç‡§ú‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§∏‡•Ä‡§ß‡•á ‡§∏‡§Ç‡§µ‡§æ‡§¶ ‡§ï‡§∞‡•á‡§Ç',
        feature6_title: '‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä',
        feature6_desc: '‡§Ü‡§∏‡§æ‡§® ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§® ‡§ï‡•á ‡§∏‡§æ‡§• 100% ‡§∏‡§Ç‡§§‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä',
        tailors_title: '‡§´‡•Ä‡§ö‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú‡•Ä',
        tailors_subtitle: '‡§π‡§Æ‡§æ‡§∞‡•á ‡§∂‡•Ä‡§∞‡•ç‡§∑-‡§∞‡•á‡§ü‡•á‡§° ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§¶‡§∞‡•ç‡§ú‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•á‡§Ç',
        testimonials_title: '‡§π‡§Æ‡§æ‡§∞‡•á ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•ç‡§Ø‡§æ ‡§ï‡§π‡§§‡•á ‡§π‡•à‡§Ç',
        testimonials_subtitle: '‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•á ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§Ö‡§®‡•Å‡§≠‡§µ',
        about_title: 'TailorConnect ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç',
        about_p1: 'TailorConnect ‡§è‡§ï ‡§∏‡§∞‡§≤ ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§∏‡•á ‡§ú‡§®‡•ç‡§Æ‡§æ ‡§•‡§æ: ‡§π‡§∞ ‡§ï‡•ã‡§à ‡§¨‡§ø‡§®‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§™‡§∞‡•á‡§∂‡§æ‡§®‡•Ä ‡§ï‡•á ‡§ï‡•Å‡§∂‡§≤ ‡§¶‡§∞‡•ç‡§ú‡•Ä ‡§ñ‡•ã‡§ú‡•á ‡§™‡§∞‡§´‡•á‡§ï‡•ç‡§ü ‡§´‡§ø‡§ü‡•á‡§°, ‡§ï‡§∏‡•ç‡§ü‡§Æ-‡§Æ‡•á‡§° ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§ï‡§æ ‡§π‡§ï‡§¶‡§æ‡§∞ ‡§π‡•à‡•§',
        about_p2: '‡§π‡§Æ ‡§™‡•ç‡§∞‡§§‡§ø‡§≠‡§æ‡§∂‡§æ‡§≤‡•Ä ‡§ò‡§∞‡•á‡§≤‡•Ç ‡§¶‡§∞‡•ç‡§ú‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§∂‡§ø‡§≤‡•ç‡§™ ‡§ï‡•å‡§∂‡§≤ ‡§ï‡•Ä ‡§§‡§≤‡§æ‡§∂ ‡§ï‡§∞‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§ï‡•Ä ‡§ñ‡§æ‡§à ‡§ï‡•ã ‡§™‡§æ‡§ü‡§§‡•á ‡§π‡•à‡§Ç‡•§',
        about_p3: '500+ ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§¶‡§∞‡•ç‡§ú‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ 50,000+ ‡§∏‡§Ç‡§§‡•Å‡§∑‡•ç‡§ü ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§•, ‡§π‡§Æ ‡§è‡§ï ‡§∏‡§Æ‡§Ø ‡§Æ‡•á‡§Ç ‡§è‡§ï ‡§∏‡§ø‡§≤‡§æ‡§à ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§ï‡•á ‡§â‡§¶‡•ç‡§Ø‡•ã‡§ó ‡§Æ‡•á‡§Ç ‡§ï‡•ç‡§∞‡§æ‡§Ç‡§§‡§ø ‡§≤‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§',
        contact_title: '‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§Æ‡•á‡§Ç ‡§∞‡§π‡•á‡§Ç',
        contact_subtitle: '‡§π‡§Æ ‡§Ü‡§™‡§∏‡•á ‡§∏‡•Å‡§®‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á',
        form_name: '‡§®‡§æ‡§Æ',
        form_email: '‡§à‡§Æ‡•á‡§≤',
        form_phone: '‡§´‡•ã‡§®',
        form_message: '‡§∏‡§Ç‡§¶‡•á‡§∂',
        btn_send: '‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡•á‡§Ç',
        contact_email: '‡§à‡§Æ‡•á‡§≤',
        contact_phone_title: '‡§´‡•ã‡§®',
        contact_address: '‡§™‡§§‡§æ',
        footer_desc: '‡§™‡§∞‡§´‡•á‡§ï‡•ç‡§ü ‡§ï‡§∏‡•ç‡§ü‡§Æ ‡§ï‡§™‡§°‡§º‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡•Å‡§∂‡§≤ ‡§¶‡§∞‡•ç‡§ú‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§ú‡•ã‡§°‡§º‡§®‡§æ‡•§',
        footer_company: '‡§ï‡§Ç‡§™‡§®‡•Ä',
        footer_about: '‡§π‡§Æ‡§æ‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç',
        footer_contact: '‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç',
        footer_careers: '‡§ï‡§∞‡§ø‡§Ø‡§∞',
        footer_blog: '‡§¨‡•ç‡§≤‡•â‡§ó',
        footer_support: '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ',
        footer_help: '‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞',
        footer_faq: 'FAQ',
        footer_terms: '‡§∏‡•á‡§µ‡§æ ‡§ï‡•Ä ‡§∂‡§∞‡•ç‡§§‡•á‡§Ç',
        footer_privacy: '‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ ‡§®‡•Ä‡§§‡§ø',
        footer_newsletter: '‡§®‡•ç‡§Ø‡•Ç‡§ú‡§º‡§≤‡•á‡§ü‡§∞',
        footer_newsletter_desc: '‡§Ö‡§™‡§°‡•á‡§ü ‡§î‡§∞ ‡§ë‡§´‡§º‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§¨‡•ç‡§∏‡§ï‡•ç‡§∞‡§æ‡§á‡§¨ ‡§ï‡§∞‡•á‡§Ç',
        btn_subscribe: '‡§∏‡§¨‡•ç‡§∏‡§ï‡•ç‡§∞‡§æ‡§á‡§¨ ‡§ï‡§∞‡•á‡§Ç'
    }
};

// ===========================
// MOCK DATA
// ===========================
const mockData = {
    tailors: [
        { id: 1, name: 'Rajesh Kumar', specialty: 'Traditional Wear', rating: 4.8, orders: 250, experience: '15 years', location: 'Mumbai' },
        { id: 2, name: 'Priya Sharma', specialty: 'Wedding Attire', rating: 4.9, orders: 180, experience: '10 years', location: 'Delhi' },
        { id: 3, name: 'Mohammed Ali', specialty: 'Formal Suits', rating: 4.7, orders: 320, experience: '20 years', location: 'Bangalore' },
        { id: 4, name: 'Anita Desai', specialty: 'Casual Wear', rating: 4.6, orders: 150, experience: '8 years', location: 'Chennai' },
        { id: 5, name: 'Suresh Patel', specialty: 'Ethnic Fashion', rating: 4.9, orders: 290, experience: '18 years', location: 'Ahmedabad' },
        { id: 6, name: 'Lakshmi Iyer', specialty: 'Designer Wear', rating: 4.8, orders: 210, experience: '12 years', location: 'Hyderabad' }
    ],
    testimonials: [
        { id: 1, name: 'Amit Verma', role: 'Business Professional', text: 'TailorConnect transformed my wardrobe! The attention to detail and perfect fit exceeded my expectations. Highly recommend!' },
        { id: 2, name: 'Sneha Reddy', role: 'Bride', text: 'Found the perfect tailor for my wedding outfits. The communication was seamless and the results were stunning!' },
        { id: 3, name: 'Karan Singh', role: 'Fashion Enthusiast', text: 'The quality of work is exceptional. I love how easy it is to track my orders and communicate with tailors.' }
    ],
    orders: [
        { id: 'ORD-001', tailorName: 'Rajesh Kumar', item: 'Sherwani', status: 'in-progress', date: '2025-10-25', amount: 8500, progress: 60 },
        { id: 'ORD-002', tailorName: 'Priya Sharma', item: 'Lehenga', status: 'pending', date: '2025-10-28', amount: 15000, progress: 0 },
        { id: 'ORD-003', tailorName: 'Mohammed Ali', item: 'Business Suit', status: 'completed', date: '2025-10-15', amount: 12000, progress: 100 }
    ],
    chats: [
        { id: 1, name: 'Rajesh Kumar', lastMessage: 'Your order is 60% complete', time: '2 min ago', unread: 2 },
        { id: 2, name: 'Priya Sharma', lastMessage: 'I\'ve received your measurements', time: '1 hour ago', unread: 0 },
        { id: 3, name: 'Mohammed Ali', lastMessage: 'Thank you for your order!', time: '2 days ago', unread: 0 }
    ],
    messages: [
        { id: 1, chatId: 1, sender: 'tailor', text: 'Hello! I\'ve started working on your sherwani.', time: '10:30 AM' },
        { id: 2, chatId: 1, sender: 'customer', text: 'Great! Can you share progress photos?', time: '10:32 AM' },
        { id: 3, chatId: 1, sender: 'tailor', text: 'Sure, I\'ll send them by evening.', time: '10:35 AM' },
        { id: 4, chatId: 1, sender: 'tailor', text: 'Your order is 60% complete', time: '2 min ago' }
    ]
};

// ===========================
// STATE MANAGEMENT
// ===========================
const state = {
    currentPage: 'home',
    currentLang: localStorage.getItem('language') || 'en',
    currentTheme: localStorage.getItem('theme') || 'light',
    currentUser: JSON.parse(localStorage.getItem('currentUser')) || null,
    testimonialIndex: 0,
    currentChatId: null,
    orderFormStep: 1,
    orders: JSON.parse(localStorage.getItem('orders')) || mockData.orders
};

// ===========================
// UTILITY FUNCTIONS
// ===========================
const utils = {
    showToast: (message, type = 'info', duration = 3000) => {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const icons = {
            success: '‚úì',
            error: '‚úï',
            warning: '‚ö†',
            info: '‚Ñπ'
        };
        
        toast.innerHTML = `
            <div class="toast-icon">${icons[type]}</div>
            <div class="toast-content">
                <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                <div class="toast-message">${message}</div>
            </div>
            <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
        `;
        
        container.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideInRight 0.3s reverse';
            setTimeout(() => toast.remove(), 300);
        }, duration);
    },
    
    validateEmail: (email) => {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    },
    
    validatePassword: (password) => {
        return password.length >= 8;
    },
    
    validatePhone: (phone) => {
        return /^[\d\s\-\+\(\)]+$/.test(phone) && phone.replace(/\D/g, '').length >= 10;
    },
    
    formatDate: (dateString) => {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' });
    },
    
    getInitials: (name) => {
        return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
    }
};

// ===========================
// LANGUAGE & THEME
// ===========================
const toggleLanguage = () => {
    state.currentLang = state.currentLang === 'en' ? 'hi' : 'en';
    localStorage.setItem('language', state.currentLang);
    document.getElementById('langToggle').querySelector('.lang-text').textContent = state.currentLang.toUpperCase();
    updateTranslations();
};

const updateTranslations = () => {
    const elements = document.querySelectorAll('[data-translate]');
    elements.forEach(el => {
        const key = el.getAttribute('data-translate');
        if (translations[state.currentLang][key]) {
            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                el.placeholder = translations[state.currentLang][key];
            } else {
                el.innerHTML = translations[state.currentLang][key];
            }
        }
    });
};

const toggleTheme = () => {
    state.currentTheme = state.currentTheme === 'light' ? 'dark' : 'light';
    localStorage.setItem('theme', state.currentTheme);
    document.documentElement.setAttribute('data-theme', state.currentTheme);
};

// ===========================
// NAVIGATION
// ===========================
const initNavigation = () => {
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const navLinks = document.getElementById('navLinks');
    
    mobileMenuToggle.addEventListener('click', () => {
        navLinks.classList.toggle('active');
        mobileMenuToggle.classList.toggle('active');
    });
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', (e) => {
            const href = anchor.getAttribute('href');
            if (href === '#' || href === '#logout') return;
            
            e.preventDefault();
            navLinks.classList.remove('active');
            mobileMenuToggle.classList.remove('active');
            
            const targetId = href.substring(1);
            navigateTo(targetId);
        });
    });
    
    window.addEventListener('scroll', () => {
        const navbar = document.getElementById('navbar');
        if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    });
    
    document.getElementById('navLogoLink').addEventListener('click', () => {
        navigateTo('home');
    });
};

const updateNavLinks = () => {
    document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('data-page') === state.currentPage) {
            link.classList.add('active');
        }
    });
};

// ===========================
// ROUTING
// ===========================
const navigateTo = (page) => {
    state.currentPage = page;
    window.history.pushState({ page }, '', `#${page}`);
    renderPage(page);
    updateNavLinks();
    window.scrollTo({ top: 0, behavior: 'smooth' });
};

const renderPage = (page) => {
    const mainContent = document.getElementById('mainContent');
    
    const pages = {
        home: renderHomePage,
        login: renderLoginPage,
        signup: renderSignupPage,
        dashboard: renderDashboard,
        profile: renderProfilePage,
        orders: renderOrdersPage,
        'order-tracking': renderOrderTrackingPage,
        'new-order': renderNewOrderPage,
        chat: renderChatPage,
        settings: renderSettingsPage
    };
    
    if (pages[page]) {
        mainContent.innerHTML = pages[page]();
        initPageScripts(page);
    }
};

// ===========================
// PAGE RENDERERS
// ===========================
const renderHomePage = () => {
    return `
        <section id="home" class="page active">
            <div class="hero-section">
                <div class="hero-content animate-fade-in">
                    <h1 class="hero-title" data-translate="hero_title">Custom Tailoring,<br>Made Simple</h1>
                    <p class="hero-subtitle" data-translate="hero_subtitle">Connect with skilled home-grown tailors and designers for bespoke clothing that fits your style perfectly</p>
                    <div class="hero-cta">
                        <button class="btn-large btn-primary" id="btnJoinCustomer">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
                            </svg>
                            <span data-translate="btn_join_customer">Join as Customer</span>
                        </button>
                        <button class="btn-large btn-outline" id="btnJoinTailor">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5z"/>
                            </svg>
                            <span data-translate="btn_join_tailor">Join as Tailor</span>
                        </button>
                    </div>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <span class="stat-number">10,000+</span>
                            <span class="stat-label" data-translate="stat_customers">Happy Customers</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">500+</span>
                            <span class="stat-label" data-translate="stat_tailors">Expert Tailors</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">50,000+</span>
                            <span class="stat-label" data-translate="stat_orders">Orders Completed</span>
                        </div>
                    </div>
                </div>
                <div class="hero-image animate-slide-in">
                    <div class="hero-image-bg"></div>
                </div>
            </div>

            <section class="features-section">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title" data-translate="features_title">Why Choose TailorConnect?</h2>
                        <p class="section-subtitle" data-translate="features_subtitle">Everything you need for perfect custom clothing</p>
                    </div>
                    <div class="features-grid">
                        ${renderFeatureCards()}
                    </div>
                </div>
            </section>

            <section class="tailors-section">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title" data-translate="tailors_title">Featured Tailors</h2>
                        <p class="section-subtitle" data-translate="tailors_subtitle">Meet our top-rated expert tailors</p>
                    </div>
                    <div class="tailors-grid">
                        ${renderTailorCards()}
                    </div>
                </div>
            </section>

            <section class="testimonials-section">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title" data-translate="testimonials_title">What Our Customers Say</h2>
                        <p class="section-subtitle" data-translate="testimonials_subtitle">Real experiences from real people</p>
                    </div>
                    <div class="testimonials-slider">
                        <button class="slider-btn prev" id="testimonialPrev">‚Äπ</button>
                        <div class="testimonials-track">
                            ${renderTestimonial()}
                        </div>
                        <button class="slider-btn next" id="testimonialNext">‚Ä∫</button>
                    </div>
                </div>
            </section>

            <section class="about-section">
                <div class="container">
                    <div class="about-content">
                        <div class="about-text animate-on-scroll">
                            <h2 class="section-title" data-translate="about_title">About TailorConnect</h2>
                            <p data-translate="about_p1">TailorConnect was born from a simple idea: everyone deserves perfectly fitted, custom-made clothing without the hassle of finding skilled tailors.</p>
                            <p data-translate="about_p2">We bridge the gap between talented home-grown tailors and customers seeking quality craftsmanship.</p>
                            <p data-translate="about_p3">With over 500 verified tailors and 50,000+ satisfied customers, we're revolutionizing the custom clothing industry.</p>
                        </div>
                        <div class="about-image animate-on-scroll">
                            <div class="about-image-bg"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="contact-section">
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title" data-translate="contact_title">Get In Touch</h2>
                        <p class="section-subtitle" data-translate="contact_subtitle">We'd love to hear from you</p>
                    </div>
                    <div class="contact-content">
                        <div class="contact-form-container">
                            <form class="contact-form" id="contactForm">
                                <div class="form-group">
                                    <label for="contactName" data-translate="form_name">Name</label>
                                    <input type="text" id="contactName" required>
                                </div>
                                <div class="form-group">
                                    <label for="contactEmail" data-translate="form_email">Email</label>
                                    <input type="email" id="contactEmail" required>
                                </div>
                                <div class="form-group">
                                    <label for="contactPhone" data-translate="form_phone">Phone</label>
                                    <input type="tel" id="contactPhone">
                                </div>
                                <div class="form-group">
                                    <label for="contactMessage" data-translate="form_message">Message</label>
                                    <textarea id="contactMessage" rows="5" required></textarea>
                                </div>
                                <button type="submit" class="btn-primary" data-translate="btn_send">Send Message</button>
                            </form>
                        </div>
                        <div class="contact-info">
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h4 data-translate="contact_address">Address</h4>
                                    <p>123 Fashion Street, Mumbai, India</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </section>
    `;
};

const renderFeatureCards = () => {
    const features = [
        { icon: 'M16 4C9.373 4 4 9.373 4 16s5.373 12 12 12 12-5.373 12-12S22.627 4 16 4z', title: 'feature1_title', desc: 'feature1_desc' },
        { icon: 'M16 2L4 8v8c0 7.732 5.373 14.675 12 16 6.627-1.325 12-8.268 12-16V8L16 2z', title: 'feature2_title', desc: 'feature2_desc' },
        { icon: 'M28 8H4a2 2 0 00-2 2v12a2 2 0 002 2h24a2 2 0 002-2V10a2 2 0 00-2-2z', title: 'feature3_title', desc: 'feature3_desc' },
        { icon: 'M28 6H4a2 2 0 00-2 2v16a2 2 0 002 2h24a2 2 0 002-2V8a2 2 0 00-2-2z', title: 'feature4_title', desc: 'feature4_desc' },
        { icon: 'M28 8c0-1.1-.9-2-2-2H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V8z', title: 'feature5_title', desc: 'feature5_desc' },
        { icon: 'M16 2C8.268 2 2 8.268 2 16s6.268 14 14 14 14-6.268 14-14S23.732 2 16 2z', title: 'feature6_title', desc: 'feature6_desc' }
    ];
    
    return features.map(f => `
        <div class="feature-card animate-on-scroll">
            <div class="feature-icon">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="currentColor">
                    <path d="${f.icon}"/>
                </svg>
            </div>
            <h3 class="feature-title" data-translate="${f.title}">Feature</h3>
            <p class="feature-description" data-translate="${f.desc}">Description</p>
        </div>
    `).join('');
};

const renderTailorCards = () => {
    return mockData.tailors.map(tailor => `
        <div class="tailor-card animate-on-scroll">
            <div class="tailor-avatar">${utils.getInitials(tailor.name)}</div>
            <div class="tailor-info">
                <h3 class="tailor-name">${tailor.name}</h3>
                <p class="tailor-specialty">${tailor.specialty}</p>
                <div class="tailor-rating">
                    <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                    <span>${tailor.rating}</span>
                </div>
                <div class="tailor-stats">
                    <div class="tailor-stat">
                        <span class="tailor-stat-value">${tailor.orders}</span>
                        <span class="tailor-stat-label">Orders</span>
                    </div>
                    <div class="tailor-stat">
                        <span class="tailor-stat-value">${tailor.experience}</span>
                        <span class="tailor-stat-label">Experience</span>
                    </div>
                </div>
            </div>
        </div>
    `).join('');
};

const renderTestimonial = () => {
    const testimonial = mockData.testimonials[state.testimonialIndex];
    return `
        <div class="testimonial-card">
            <p class="testimonial-text">"${testimonial.text}"</p>
            <div class="testimonial-author">
                <div class="testimonial-avatar">${utils.getInitials(testimonial.name)}</div>
                <div class="testimonial-details">
                    <h4>${testimonial.name}</h4>
                    <p>${testimonial.role}</p>
                </div>
            </div>
        </div>
    `;
};

const renderLoginPage = () => {
    return `
        <div class="auth-page">
            <div class="auth-container">
                <div class="auth-header">
                    <h1>Welcome Back</h1>
                    <p>Login to continue to TailorConnect</p>
                </div>
                
                <div class="auth-tabs">
                    <button class="auth-tab active" data-role="customer">Customer</button>
                    <button class="auth-tab" data-role="tailor">Tailor</button>
                </div>
                
                <form class="auth-form" id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <div class="password-input">
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('loginPassword')">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-options">
                        <label class="form-checkbox">
                            <input type="checkbox" id="rememberMe">
                            <span>Remember me</span>
                        </label>
                        <a href="#" class="form-link">Forgot password?</a>
                    </div>
                    
                    <button type="submit" class="btn-primary" style="width: 100%;">Login</button>
                </form>
                
                <div class="auth-divider">OR</div>
                
                <div class="auth-footer">
                    Don't have an account? <a href="#signup" class="form-link">Sign up</a>
                </div>
            </div>
        </div>
    `;
};

const renderSignupPage = () => {
    return `
        <div class="auth-page">
            <div class="auth-container">
                <div class="auth-header">
                    <h1>Create Account</h1>
                    <p>Join TailorConnect today</p>
                </div>
                
                <div class="auth-tabs">
                    <button class="auth-tab active" data-role="customer">Customer</button>
                    <button class="auth-tab" data-role="tailor">Tailor</button>
                </div>
                
                <form class="auth-form" id="signupForm">
                    <div class="form-group">
                        <label for="signupName">Full Name</label>
                        <input type="text" id="signupName" placeholder="Enter your name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" placeholder="Enter your email" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupPhone">Phone Number</label>
                        <input type="tel" id="signupPhone" placeholder="Enter your phone" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <div class="password-input">
                            <input type="password" id="signupPassword" placeholder="Create password (min 8 characters)" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('signupPassword')">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupConfirmPassword">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" placeholder="Re-enter password" required>
                    </div>
                    
                    <button type="submit" class="btn-primary" style="width: 100%;">Create Account</button>
                </form>
                
                <div class="auth-footer">
                    Already have an account? <a href="#login" class="form-link">Login</a>
                </div>
            </div>
        </div>
    `;
};

const renderDashboard = () => {
    if (!state.currentUser) {
        navigateTo('login');
        return '';
    }
    
    const isCustomer = state.currentUser.role === 'customer';
    
    return `
        <div class="dashboard-page">
            <aside class="dashboard-sidebar">
                <nav class="sidebar-nav">
                    ${isCustomer ? `
                        <a href="#dashboard" class="sidebar-link active">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                            </svg>
                            Dashboard
                        </a>
                        <a href="#orders" class="sidebar-link">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5z"/>
                            </svg>
                            My Orders
                        </a>
                        <a href="#new-order" class="sidebar-link">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z"/>
                            </svg>
                            New Order
                        </a>
                        <a href="#order-tracking" class="sidebar-link">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"/>
                            </svg>
                            Track Orders
                        </a>
                    ` : `
                        <a href="#dashboard" class="sidebar-link active">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                            </svg>
                            Dashboard
                        </a>
                        <a href="#orders" class="sidebar-link">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5z"/>
                            </svg>
                            Orders
                        </a>
                        <a href="#profile" class="sidebar-link">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"/>
                            </svg>
                            Manage Profile
                        </a>
                    `}
                    <a href="#chat" class="sidebar-link">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"/>
                            <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"/>
                        </svg>
                        Messages
                    </a>
                    <a href="#profile" class="sidebar-link">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
                        </svg>
                        Profile
                    </a>
                    <a href="#settings" class="sidebar-link">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z"/>
                        </svg>
                        Settings
                    </a>
                </nav>
            </aside>
            
            <main class="dashboard-main">
                <div class="dashboard-header">
                    <h1>Welcome back, ${state.currentUser.name}!</h1>
                    <p>Here's what's happening with your orders today</p>
                </div>
                
                <div class="dashboard-stats">
                    ${isCustomer ? `
                        <div class="stat-card">
                            <div class="stat-icon primary">üìã</div>
                            <div class="stat-details">
                                <h3>Total Orders</h3>
                                <div class="stat-value">${state.orders.length}</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon info">üîÑ</div>
                            <div class="stat-details">
                                <h3>In Progress</h3>
                                <div class="stat-value">${state.orders.filter(o => o.status === 'in-progress').length}</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon success">‚úì</div>
                            <div class="stat-details">
                                <h3>Completed</h3>
                                <div class="stat-value">${state.orders.filter(o => o.status === 'completed').length}</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon warning">‚è≥</div>
                            <div class="stat-details">
                                <h3>Pending</h3>
                                <div class="stat-value">${state.orders.filter(o => o.status === 'pending').length}</div>
                            </div>
                        </div>
                    ` : `
                        <div class="stat-card">
                            <div class="stat-icon primary">üì¶</div>
                            <div class="stat-details">
                                <h3>Total Orders</h3>
                                <div class="stat-value">45</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon success">üí∞</div>
                            <div class="stat-details">
                                <h3>Revenue</h3>
                                <div class="stat-value">‚Çπ2.5L</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon info">‚≠ê</div>
                            <div class="stat-details">
                                <h3>Rating</h3>
                                <div class="stat-value">4.8</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon warning">üë•</div>
                            <div class="stat-details">
                                <h3>Customers</h3>
                                <div class="stat-value">120</div>
                            </div>
                        </div>
                    `}
                </div>
                
                <div class="dashboard-content">
                    <div class="dashboard-section">
                        <div class="section-header-with-action">
                            <h2>Recent Orders</h2>
                            <a href="#orders" class="btn-primary btn-sm">View All</a>
                        </div>
                        <div class="orders-grid">
                            ${renderOrderCards(state.orders.slice(0, 3))}
                        </div>
                    </div>
                </div>
            </main>
        </div>
    `;
};

const renderOrderCards = (orders) => {
    return orders.map(order => `
        <div class="order-card">
            <div class="order-header">
                <span class="order-id">${order.id}</span>
                <span class="order-status ${order.status}">${order.status.replace('-', ' ')}</span>
            </div>
            <div class="order-details">
                <div class="order-detail-item">
                    <span>Tailor:</span>
                    <span>${order.tailorName}</span>
                </div>
                <div class="order-detail-item">
                    <span>Item:</span>
                    <span>${order.item}</span>
                </div>
                <div class="order-detail-item">
                    <span>Date:</span>
                    <span>${utils.formatDate(order.date)}</span>
                </div>
                <div class="order-detail-item">
                    <span>Amount:</span>
                    <span>‚Çπ${order.amount.toLocaleString()}</span>
                </div>
            </div>
            ${order.status === 'in-progress' ? `
                <div class="order-progress">
                    <div class="progress-label">
                        <span>Progress</span>
                        <span>${order.progress}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${order.progress}%"></div>
                    </div>
                </div>
            ` : ''}
            <div class="order-actions">
                <button class="btn-sm btn-primary" onclick="navigateTo('order-tracking')">Track</button>
                <button class="btn-sm btn-secondary" onclick="navigateTo('chat')">Message</button>
            </div>
        </div>
    `).join('');
};

const renderOrdersPage = () => {
    return `
        <div class="dashboard-page">
            <aside class="dashboard-sidebar">
                ${renderSidebarNav('orders')}
            </aside>
            <main class="dashboard-main">
                <div class="dashboard-header">
                    <h1>My Orders</h1>
                    <p>View and manage all your orders</p>
                </div>
                <div class="dashboard-section">
                    <div class="orders-grid">
                        ${renderOrderCards(state.orders)}
                    </div>
                </div>
            </main>
        </div>
    `;
};

const renderSidebarNav = (activePage) => {
    return `
        <nav class="sidebar-nav">
            <a href="#dashboard" class="sidebar-link ${activePage === 'dashboard' ? 'active' : ''}">Dashboard</a>
            <a href="#orders" class="sidebar-link ${activePage === 'orders' ? 'active' : ''}">My Orders</a>
            <a href="#new-order" class="sidebar-link ${activePage === 'new-order' ? 'active' : ''}">New Order</a>
            <a href="#order-tracking" class="sidebar-link ${activePage === 'order-tracking' ? 'active' : ''}">Track Orders</a>
            <a href="#chat" class="sidebar-link ${activePage === 'chat' ? 'active' : ''}">Messages</a>
            <a href="#profile" class="sidebar-link ${activePage === 'profile' ? 'active' : ''}">Profile</a>
            <a href="#settings" class="sidebar-link ${activePage === 'settings' ? 'active' : ''}">Settings</a>
        </nav>
    `;
};

const renderOrderTrackingPage = () => {
    const order = state.orders[0];
    return `
        <div class="order-tracking-page">
            <h1>Track Your Order</h1>
            <div class="tracking-card">
                <h2>Order ${order.id}</h2>
                <div class="order-details">
                    <div class="order-detail-item">
                        <span>Item:</span>
                        <span>${order.item}</span>
                    </div>
                    <div class="order-detail-item">
                        <span>Tailor:</span>
                        <span>${order.tailorName}</span>
                    </div>
                    <div class="order-detail-item">
                        <span>Status:</span>
                        <span class="order-status ${order.status}">${order.status}</span>
                    </div>
                </div>
            </div>
            
            <div class="tracking-card">
                <h2>Order Timeline</h2>
                <div class="tracking-timeline">
                    <div class="timeline-item completed">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h3>Order Placed</h3>
                            <p>Your order has been received</p>
                            <span class="timeline-date">${utils.formatDate(order.date)}</span>
                        </div>
                    </div>
                    <div class="timeline-item ${order.status !== 'pending' ? 'completed' : ''}">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h3>Order Accepted</h3>
                            <p>Tailor has accepted your order</p>
                            <span class="timeline-date">${order.status !== 'pending' ? utils.formatDate(order.date) : 'Pending'}</span>
                        </div>
                    </div>
                    <div class="timeline-item ${order.status === 'in-progress' || order.status === 'completed' ? 'active' : ''}">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h3>In Progress</h3>
                            <p>Your clothing is being tailored</p>
                            <span class="timeline-date">${order.status === 'in-progress' || order.status === 'completed' ? 'In Progress' : 'Pending'}</span>
                        </div>
                    </div>
                    <div class="timeline-item ${order.status === 'completed' ? 'completed' : ''}">
                        <div class="timeline-dot"></div>
                        <div class="timeline-content">
                            <h3>Ready for Delivery</h3>
                            <p>Your order is ready</p>
                            <span class="timeline-date">${order.status === 'completed' ? utils.formatDate(order.date) : 'Pending'}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
};

const renderNewOrderPage = () => {
    return `
        <div class="order-form-page">
            <h1>Create New Order</h1>
            <div class="order-form-container">
                <div class="form-steps">
                    <div class="form-step ${state.orderFormStep === 1 ? 'active' : state.orderFormStep > 1 ? 'completed' : ''}">
                        <div class="step-number">1</div>
                        <span class="step-label">Select Tailor</span>
                    </div>
                    <div class="form-step ${state.orderFormStep === 2 ? 'active' : state.orderFormStep > 2 ? 'completed' : ''}">
                        <div class="step-number">2</div>
                        <span class="step-label">Design & Details</span>
                    </div>
                    <div class="form-step ${state.orderFormStep === 3 ? 'active' : state.orderFormStep > 3 ? 'completed' : ''}">
                        <div class="step-number">3</div>
                        <span class="step-label">Measurements</span>
                    </div>
                    <div class="form-step ${state.orderFormStep === 4 ? 'active' : ''}">
                        <div class="step-number">4</div>
                        <span class="step-label">Confirm</span>
                    </div>
                </div>
                
                <form id="orderForm">
                    <div class="step-content ${state.orderFormStep === 1 ? 'active' : ''}">
                        <div class="form-section">
                            <h3>Choose Your Tailor</h3>
                            <div class="tailors-grid">
                                ${mockData.tailors.slice(0, 3).map(tailor => `
                                    <div class="tailor-card" onclick="selectTailor(${tailor.id})">
                                        <div class="tailor-avatar">${utils.getInitials(tailor.name)}</div>
                                        <div class="tailor-info">
                                            <h3 class="tailor-name">${tailor.name}</h3>
                                            <p class="tailor-specialty">${tailor.specialty}</p>
                                            <div class="tailor-rating">
                                                <span class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                                <span>${tailor.rating}</span>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-content ${state.orderFormStep === 2 ? 'active' : ''}">
                        <div class="form-section">
                            <h3>Design Details</h3>
                            <div class="form-group">
                                <label for="itemType">Item Type</label>
                                <select id="itemType" required>
                                    <option value="">Select item type</option>
                                    <option value="Shirt">Shirt</option>
                                    <option value="Suit">Suit</option>
                                    <option value="Dress">Dress</option>
                                    <option value="Traditional Wear">Traditional Wear</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orderDescription">Description</label>
                                <textarea id="orderDescription" rows="4" placeholder="Describe your requirements"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Upload Design Reference (Optional)</label>
                                <div class="file-upload">
                                    <input type="file" id="designFile" accept="image/*">
                                    <div class="file-upload-icon">üì∑</div>
                                    <p>Click to upload or drag and drop</p>
                                    <p style="font-size: 0.875rem; color: var(--text-tertiary);">PNG, JPG up to 10MB</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-content ${state.orderFormStep === 3 ? 'active' : ''}">
                        <div class="form-section">
                            <h3>Your Measurements</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="chest">Chest (inches)</label>
                                    <input type="number" id="chest" placeholder="38">
                                </div>
                                <div class="form-group">
                                    <label for="waist">Waist (inches)</label>
                                    <input type="number" id="waist" placeholder="32">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="shoulders">Shoulders (inches)</label>
                                    <input type="number" id="shoulders" placeholder="16">
                                </div>
                                <div class="form-group">
                                    <label for="sleeves">Sleeves (inches)</label>
                                    <input type="number" id="sleeves" placeholder="24">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="length">Length (inches)</label>
                                    <input type="number" id="length" placeholder="28">
                                </div>
                                <div class="form-group">
                                    <label for="neck">Neck (inches)</label>
                                    <input type="number" id="neck" placeholder="15">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-content ${state.orderFormStep === 4 ? 'active' : ''}">
                        <div class="form-section">
                            <h3>Order Summary</h3>
                            <p>Review your order details before submission</p>
                            <div class="tracking-card" style="margin-top: 1rem;">
                                <div class="order-details">
                                    <div class="order-detail-item">
                                        <span>Tailor:</span>
                                        <span id="confirmTailor">Rajesh Kumar</span>
                                    </div>
                                    <div class="order-detail-item">
                                        <span>Item Type:</span>
                                        <span id="confirmItem">-</span>
                                    </div>
                                    <div class="order-detail-item">
                                        <span>Estimated Cost:</span>
                                        <span id="confirmCost">‚Çπ8,500</span>
                                    </div>
                                    <div class="order-detail-item">
                                        <span>Delivery Time:</span>
                                        <span>7-10 days</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-navigation">
                        <button type="button" class="btn-secondary" id="prevStepBtn" ${state.orderFormStep === 1 ? 'style="visibility: hidden;"' : ''}>Previous</button>
                        <button type="button" class="btn-primary" id="nextStepBtn">${state.orderFormStep === 4 ? 'Submit Order' : 'Next'}</button>
                    </div>
                </form>
            </div>
        </div>
    `;
};

const renderChatPage = () => {
    return `
        <div class="chat-page">
            <aside class="chat-sidebar">
                <div class="chat-search">
                    <input type="text" placeholder="Search conversations...">
                </div>
                <div class="chat-list">
                    ${mockData.chats.map(chat => `
                        <div class="chat-list-item ${state.currentChatId === chat.id ? 'active' : ''}" onclick="selectChat(${chat.id})">
                            <div class="chat-avatar">${utils.getInitials(chat.name)}</div>
                            <div class="chat-preview">
                                <div class="chat-preview-header">
                                    <span class="chat-name">${chat.name}</span>
                                    <span class="chat-time">${chat.time}</span>
                                </div>
                                <p class="chat-last-message">${chat.lastMessage}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </aside>
            
            <main class="chat-main">
                ${state.currentChatId ? `
                    <div class="chat-header">
                        <div class="chat-header-info">
                            <div class="chat-avatar">${utils.getInitials(mockData.chats.find(c => c.id === state.currentChatId).name)}</div>
                            <div>
                                <h3>${mockData.chats.find(c => c.id === state.currentChatId).name}</h3>
                                <p style="font-size: 0.875rem; color: var(--text-tertiary);">Active now</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        ${mockData.messages.filter(m => m.chatId === state.currentChatId).map(msg => `
                            <div class="message ${msg.sender === 'customer' ? 'sent' : ''}">
                                <div class="message-avatar">${msg.sender === 'customer' ? 'Y' : 'T'}</div>
                                <div class="message-content">
                                    <div class="message-bubble">${msg.text}</div>
                                    <span class="message-time">${msg.time}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="chat-input-container">
                        <form class="chat-input-wrapper" id="chatForm">
                            <div class="chat-input-actions">
                                <button type="button" class="icon-btn">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/>
                                    </svg>
                                </button>
                            </div>
                            <input type="text" id="chatInput" placeholder="Type a message..." required>
                            <button type="submit" class="btn-primary">Send</button>
                        </form>
                    </div>
                ` : `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-tertiary);">
                        <p>Select a conversation to start messaging</p>
                    </div>
                `}
            </main>
        </div>
    `;
};

const renderProfilePage = () => {
    if (!state.currentUser) {
        navigateTo('login');
        return '';
    }
    
    return `
        <div class="profile-page">
            <div class="profile-header">
                <div class="profile-info">
                    <div class="profile-avatar">${utils.getInitials(state.currentUser.name)}</div>
                    <div class="profile-details">
                        <h1>${state.currentUser.name}</h1>
                        <p>${state.currentUser.email}</p>
                        <div class="profile-meta">
                            <span>üìç ${state.currentUser.location || 'Mumbai, India'}</span>
                            <span>üìû ${state.currentUser.phone}</span>
                            <span>üë§ ${state.currentUser.role === 'customer' ? 'Customer' : 'Tailor'}</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="profile-content">
                <div class="profile-section">
                    <div class="section-header-with-action">
                        <h2>Personal Information</h2>
                        <button class="btn-primary btn-sm">Edit</button>
                    </div>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Full Name</span>
                            <span class="info-value">${state.currentUser.name}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Email</span>
                            <span class="info-value">${state.currentUser.email}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Phone</span>
                            <span class="info-value">${state.currentUser.phone}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Location</span>
                            <span class="info-value">${state.currentUser.location || 'Mumbai, India'}</span>
                        </div>
                    </div>
                </div>
                
                ${state.currentUser.role === 'customer' ? `
                    <div class="profile-section">
                        <h2>Saved Measurements</h2>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Chest</span>
                                <span class="info-value">38 inches</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Waist</span>
                                <span class="info-value">32 inches</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Shoulders</span>
                                <span class="info-value">16 inches</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Sleeves</span>
                                <span class="info-value">24 inches</span>
                            </div>
                        </div>
                    </div>
                ` : `
                    <div class="profile-section">
                        <h2>Professional Details</h2>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Specialty</span>
                                <span class="info-value">Traditional Wear</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Experience</span>
                                <span class="info-value">15 years</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Rating</span>
                                <span class="info-value">4.8 ‚≠ê</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Total Orders</span>
                                <span class="info-value">250</span>
                            </div>
                        </div>
                    </div>
                `}
            </div>
        </div>
    `;
};

const renderSettingsPage = () => {
    return `
        <div class="dashboard-page">
            <aside class="dashboard-sidebar">
                ${renderSidebarNav('settings')}
            </aside>
            <main class="dashboard-main">
                <div class="dashboard-header">
                    <h1>Settings</h1>
                    <p>Manage your account preferences</p>
                </div>
                
                <div class="dashboard-section">
                    <h2>Appearance</h2>
                    <div class="form-group">
                        <label>Theme</label>
                        <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                            <button class="btn-secondary" onclick="setTheme('light')">Light</button>
                            <button class="btn-secondary" onclick="setTheme('dark')">Dark</button>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label>Language</label>
                        <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                            <button class="btn-secondary" onclick="setLanguage('en')">English</button>
                            <button class="btn-secondary" onclick="setLanguage('hi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-section">
                    <h2>Notifications</h2>
                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" checked>
                            <span>Email notifications</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox" checked>
                            <span>Order updates</span>
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-checkbox">
                            <input type="checkbox">
                            <span>Marketing emails</span>
                        </label>
                    </div>
                </div>
                
                <div class="dashboard-section">
                    <h2>Security</h2>
                    <button class="btn-primary">Change Password</button>
                    <button class="btn-secondary" style="margin-left: 1rem;">Enable 2FA</button>
                </div>
            </main>
        </div>
    `;
};

// ===========================
// PAGE INITIALIZATION
// ===========================
const initPageScripts = (page) => {
    updateTranslations();
    
    if (page === 'home') {
        initHomePage();
    } else if (page === 'login') {
        initLoginPage();
    } else if (page === 'signup') {
        initSignupPage();
    } else if (page === 'new-order') {
        initOrderFormPage();
    } else if (page === 'chat') {
        initChatPage();
    }
    
    initScrollAnimations();
};

const initHomePage = () => {
    document.getElementById('btnJoinCustomer')?.addEventListener('click', () => navigateTo('signup'));
    document.getElementById('btnJoinTailor')?.addEventListener('click', () => navigateTo('signup'));
    
    document.getElementById('contactForm')?.addEventListener('submit', (e) => {
        e.preventDefault();
        utils.showToast('Message sent successfully!', 'success');
        e.target.reset();
    });
    
    document.getElementById('newsletterForm')?.addEventListener('submit', (e) => {
        e.preventDefault();
        utils.showToast('Subscribed successfully!', 'success');
        e.target.reset();
    });
    
    document.getElementById('testimonialPrev')?.addEventListener('click', () => {
        state.testimonialIndex = (state.testimonialIndex - 1 + mockData.testimonials.length) % mockData.testimonials.length;
        document.querySelector('.testimonials-track').innerHTML = renderTestimonial();
    });
    
    document.getElementById('testimonialNext')?.addEventListener('click', () => {
        state.testimonialIndex = (state.testimonialIndex + 1) % mockData.testimonials.length;
        document.querySelector('.testimonials-track').innerHTML = renderTestimonial();
    });
};

const initLoginPage = () => {
    document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
        });
    });
    
    document.getElementById('loginForm')?.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const role = document.querySelector('.auth-tab.active').getAttribute('data-role');
        
        if (!utils.validateEmail(email)) {
            utils.showToast('Please enter a valid email', 'error');
            return;
        }
        
        if (!utils.validatePassword(password)) {
            utils.showToast('Password must be at least 8 characters', 'error');
            return;
        }
        
        const user = {
            name: email.split('@')[0],
            email: email,
            phone: '+91 98765 43210',
            role: role
        };
        
        state.currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(user));
        
        updateUserMenu();
        utils.showToast('Login successful!', 'success');
        navigateTo('dashboard');
    });
};

const initSignupPage = () => {
    document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
        });
    });
    
    document.getElementById('signupForm')?.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const name = document.getElementById('signupName').value;
        const email = document.getElementById('signupEmail').value;
        const phone = document.getElementById('signupPhone').value;
        const password = document.getElementById('signupPassword').value;
        const confirmPassword = document.getElementById('signupConfirmPassword').value;
        const role = document.querySelector('.auth-tab.active').getAttribute('data-role');
        
        if (!utils.validateEmail(email)) {
            utils.showToast('Please enter a valid email', 'error');
            return;
        }
        
        if (!utils.validatePhone(phone)) {
            utils.showToast('Please enter a valid phone number', 'error');
            return;
        }
        
        if (!utils.validatePassword(password)) {
            utils.showToast('Password must be at least 8 characters', 'error');
            return;
        }
        
        if (password !== confirmPassword) {
            utils.showToast('Passwords do not match', 'error');
            return;
        }
        
        const user = {
            name: name,
            email: email,
            phone: phone,
            role: role
        };
        
        state.currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(user));
        
        updateUserMenu();
        utils.showToast('Account created successfully!', 'success');
        navigateTo('dashboard');
    });
};

const initOrderFormPage = () => {
    document.getElementById('nextStepBtn')?.addEventListener('click', () => {
        if (state.orderFormStep < 4) {
            if (state.orderFormStep === 2) {
                const itemType = document.getElementById('itemType')?.value;
                if (itemType) {
                    document.getElementById('confirmItem').textContent = itemType;
                }
            }
            state.orderFormStep++;
            navigateTo('new-order');
        } else {
            const newOrder = {
                id: 'ORD-' + String(state.orders.length + 1).padStart(3, '0'),
                tailorName: 'Rajesh Kumar',
                item: document.getElementById('itemType')?.value || 'Custom Item',
                status: 'pending',
                date: new Date().toISOString().split('T')[0],
                amount: 8500,
                progress: 0
            };
            
            state.orders.unshift(newOrder);
            localStorage.setItem('orders', JSON.stringify(state.orders));
            
            utils.showToast('Order placed successfully!', 'success');
            state.orderFormStep = 1;
            navigateTo('dashboard');
        }
    });
    
    document.getElementById('prevStepBtn')?.addEventListener('click', () => {
        if (state.orderFormStep > 1) {
            state.orderFormStep--;
            navigateTo('new-order');
        }
    });
};

const initChatPage = () => {
    if (!state.currentChatId && mockData.chats.length > 0) {
        state.currentChatId = mockData.chats[0].id;
    }
    
    document.getElementById('chatForm')?.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (message) {
            const newMessage = {
                id: mockData.messages.length + 1,
                chatId: state.currentChatId,
                sender: 'customer',
                text: message,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };
            
            mockData.messages.push(newMessage);
            
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.innerHTML += `
                <div class="message sent">
                    <div class="message-avatar">Y</div>
                    <div class="message-content">
                        <div class="message-bubble">${message}</div>
                        <span class="message-time">${newMessage.time}</span>
                    </div>
                </div>
            `;
            
            input.value = '';
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    });
    
    const messagesContainer = document.getElementById('chatMessages');
    if (messagesContainer) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
};

const initScrollAnimations = () => {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1 });
    
    document.querySelectorAll('.animate-on-scroll').forEach(el => {
        observer.observe(el);
    });
};

// ===========================
// HELPER FUNCTIONS
// ===========================
window.togglePasswordVisibility = (inputId) => {
    const input = document.getElementById(inputId);
    input.type = input.type === 'password' ? 'text' : 'password';
};

window.selectTailor = (tailorId) => {
    state.orderFormStep = 2;
    navigateTo('new-order');
};

window.selectChat = (chatId) => {
    state.currentChatId = chatId;
    navigateTo('chat');
};

window.setTheme = (theme) => {
    state.currentTheme = theme;
    localStorage.setItem('theme', theme);
    document.documentElement.setAttribute('data-theme', theme);
    utils.showToast(`Theme changed to ${theme}`, 'success');
};

window.setLanguage = (lang) => {
    state.currentLang = lang;
    localStorage.setItem('language', lang);
    document.getElementById('langToggle').querySelector('.lang-text').textContent = lang.toUpperCase();
    updateTranslations();
    utils.showToast(`Language changed to ${lang === 'en' ? 'English' : '‡§π‡§ø‡§Ç‡§¶‡•Ä'}`, 'success');
};

const updateUserMenu = () => {
    if (state.currentUser) {
        document.querySelector('.btn-login').style.display = 'none';
        document.querySelector('.btn-signup').style.display = 'none';
        document.getElementById('userMenu').classList.remove('hidden');
        document.getElementById('userInitials').textContent = utils.getInitials(state.currentUser.name);
        document.getElementById('userName').textContent = state.currentUser.name;
        document.getElementById('userRole').textContent = state.currentUser.role === 'customer' ? 'Customer' : 'Tailor';
    } else {
        document.querySelector('.btn-login').style.display = 'inline-flex';
        document.querySelector('.btn-signup').style.display = 'inline-flex';
        document.getElementById('userMenu').classList.add('hidden');
    }
};

// ===========================
// INITIALIZATION
// ===========================
document.addEventListener('DOMContentLoaded', () => {
    document.documentElement.setAttribute('data-theme', state.currentTheme);
    
    initNavigation();
    
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    document.getElementById('langToggle').addEventListener('click', toggleLanguage);
    
    document.getElementById('btnLogin')?.addEventListener('click', () => navigateTo('login'));
    document.getElementById('btnSignup')?.addEventListener('click', () => navigateTo('signup'));
    document.getElementById('btnLogout')?.addEventListener('click', () => {
        state.currentUser = null;
        localStorage.removeItem('currentUser');
        updateUserMenu();
        utils.showToast('Logged out successfully', 'success');
        navigateTo('home');
    });
    
    window.addEventListener('popstate', (e) => {
        const page = e.state?.page || 'home';
        state.currentPage = page;
        renderPage(page);
        updateNavLinks();
    });
    
    const hash = window.location.hash.substring(1) || 'home';
    navigateTo(hash);
    
    updateUserMenu();
    updateTranslations();
});

